<!DOCTYPE html>
<html>
<head>
	<title>Document is easy</title>
	<link rel="stylesheet" type="text/css" href="/page/css/style.css">
</head>
<body>
	
	<div class="title">
		<p>A simple chat app on NodeJs And Socket IO</p>
	</div>
	
	<ul id="messages"></ul>
	<div class="scroll"></div>
	<div class="name fixed-center" id="name-container">
		<div class="container bg-light">
					
			<p>Enter your name: </p>
			<form action="" method="post" id="name-form" accept-charset="utf-8">
				<div class="form-group">
					<input type="text" id="name" name="name" placeholder="Ram..">
					<button id="nameSubmit" type="button">Keep my name</button>
				</div>
			</form>
					
		</div>
	</div>
		
	<form action="" id="chat-form">
		<input id="m" autocomplete="off" /><button>Send</button>
	</form>
	

	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>

	<script>
		
		$('#name-form').submit(function(e){
			e.preventDefault();
			$('#nameSubmit').click();
		});
		$('#nameSubmit').click(function(e){
			e.preventDefault();
			var name = $('#name').val();
			var nameLength = $('#name').val().length; 
			
			console.log(name+ " is of char "+ nameLength);
			if (nameLength > 4) {
				$('#name').attr('value',name);
				$('#name').attr('type','hidden');
				$('#name-container').hide();
			}else{
				var error = "<p class='name-error'>Name must be greater than four char</p>"+ nameLength;
				if ($('.name-error').length == 0) {
					$(error).appendTo('#form-group');
				}
			}
		})

		var socket = io();
		$('#chat-form').submit(function(){
			socket.emit('chat message', $('#m').val(),$('#name').val());
			$('#m').val('');
			window.scrollTo(0,document.body.scrollHeight);
			return false;
		});
		
		socket.on('chat message', function(msg,user){
			console.log(msg);
			var message = "<li>"+user+" says: <strong>"+msg+"</strong></li>";
			$('#messages').append(message);
			window.scrollTo(0,document.body.scrollHeight);
		});

		socket.on('newUser', function(){
			socket.broadcast.emit('User connected');
		});

	</script>
</body>
</html>