<!DOCTYPE html>
<html>
<head>
	<title>Document is easy</title>
	<link rel="stylesheet" type="text/css" href="/page/css/style.css">
</head>
<body>
	<div class="container">
		<div class="section" id="chat-lists">
			<div class="jumbotron">
				<h1>Welcome to RTCS</h1>
				<p>Take a look at our top chat sites and join/create one of the room. </p>
				<p>And remember to love <strong>spring</strong>. We all love spring and so should you</p>
				<p class="text-success mt-2">Currently online:</p>
			</div>
			<div class="mt-2"></div>
			<p class="title">Chat rooms</p>
			<ul class="list-items">
			    <li class="chat-room-list"><a class="chat-room w-100" href="/chat/room1">Global Chat</a></li>
			    <li class="chat-room-list"><a class="chat-room w-100" href="/chat/room1">Room 1</a></li>
			    <li class="chat-room-list"><a class="chat-room w-100" href="/chat/room1">Coders</a></li>
			</ul>
		</div>


		<div class="section bg-light v-all" id="chat-section">
			<div class="absolute v-all w-100 overlay all-0 f-column" id="chat-overlay">
				<div class="vertical-center">		
					<form id="name-form" action="" accept-charset="utf-8" class="d-flex">
						<div class="from-group">
							<input type="text" placeholder="Enter Your Name" id="name" class="w-100 py-2" name="name">
						</div>
						<button type="submit" class="py-2" id="nameSubmit">Submit</button>
					</form>
				</div>
			</div>

			<p class="w-100 bg-white border-black mb-2">Say Hi in chat</p> 
			<div id="messages">
			    
			</div>
				
				
			<form id="chat-form" action="" method="" class="absolute-bottom w-100" accept-charset="utf-8">
				<input type="text" autofocus class="absolute-bottom w-100 py-2" id="m">
			</form>
		</div>

	</div>	
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="/page/js/chat-index.js"><script>
	<script>
		$('#name-form').submit(function(e){
	e.preventDefault();
	$('#nameSubmit').click();
	return false;
});

$('#nameSubmit').click(function(e){
	e.preventDefault();
	var name = $('#name').val();
	var nameLength = $('#name').val().length; 
	
	console.log(name+ " is of char "+ nameLength);
	if (nameLength > 4) {
		$('#name').attr('value',name);
		$('#name').attr('type','hidden');
		$('#chat-overlay').hide();
	}else{
		var error = "<p class='name-error'>Name must be greater than four char</p>"+ nameLength;
		if ($('.name-error').length == 0) {
			$(error).appendTo('#form-group');
		}
	}
})

var socket = io();

$('#chat-form').submit(function(e){
	e.preventDefault();

	var msg = $('#m').val();
	
	socket.emit('chat message', msg,$('#name').val());
	var message = "<p class='user'><span>"+msg+"</span></p>";
	$('#messages').append(message);
	
	msg.val('');
	window.scrollTo(0,document.body.scrollHeight);
	
	return false;
});

socket.on('chat message', function(msg,user){
	console.log(msg);
	
	var message = "<p>"+user+" says:<span>"+msg+"</span></p>";
	$('#messages').append(message);
	
	window.scrollTo(0,document.body.scrollHeight);
});

socket.on('newUser', function(){
	socket.broadcast.emit('User connected');
});


	</script>
</body>
</html>